Date: Thu, 17 Mar 2022 08:53:35 +0000 (UTC)
Message-ID: <516630605.9.1647507215344@70134d001b6d>
Subject: Exported From Confluence
MIME-Version: 1.0
Content-Type: multipart/related; 
	boundary="----=_Part_8_1061738197.1647507215344"

------=_Part_8_1061738197.1647507215344
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-Location: file:///C:/exported.html

<html xmlns:o=3D'urn:schemas-microsoft-com:office:office'
      xmlns:w=3D'urn:schemas-microsoft-com:office:word'
      xmlns:v=3D'urn:schemas-microsoft-com:vml'
      xmlns=3D'urn:w3-org-ns:HTML'>
<head>
    <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8=
">
    <title>Kube bench test report on DIY Cluster</title>
    <!--[if gte mso 9]>
    <xml>
        <o:OfficeDocumentSettings>
            <o:TargetScreenSize>1024x640</o:TargetScreenSize>
            <o:PixelsPerInch>72</o:PixelsPerInch>
            <o:AllowPNG/>
        </o:OfficeDocumentSettings>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
                <!--
        @page Section1 {
            size: 8.5in 11.0in;
            margin: 1.0in;
            mso-header-margin: .5in;
            mso-footer-margin: .5in;
            mso-paper-source: 0;
        }

        table {
            border: solid 1px;
            border-collapse: collapse;
        }

        table td, table th {
            border: solid 1px;
            padding: 5px;
        }

        td {
            page-break-inside: avoid;
        }

        tr {
            page-break-after: avoid;
        }

        div.Section1 {
            page: Section1;
        }

        /* Confluence print stylesheet. Common to all themes for print medi=
a */
/* Full of !important until we improve batching for print CSS */

@media print {
    #main {
        padding-bottom: 1em !important; /* The default padding of 6em is to=
o much for printouts */
    }

    body {
        font-family: Arial, Helvetica, FreeSans, sans-serif;
        font-size: 10pt;
        line-height: 1.2;
    }

    body, #full-height-container, #main, #page, #content, .has-personal-sid=
ebar #content {
        background: #fff !important;
        color: #000 !important;
        border: 0 !important;
        width: 100% !important;
        height: auto !important;
        min-height: auto !important;
        margin: 0 !important;
        padding: 0 !important;
        display: block !important;
    }

    a, a:link, a:visited, a:focus, a:hover, a:active {
        color: #000;
    }

    #content h1,
    #content h2,
    #content h3,
    #content h4,
    #content h5,
    #content h6 {
        font-family: Arial, Helvetica, FreeSans, sans-serif;
        page-break-after: avoid;
    }

    pre {
        font-family: Monaco, "Courier New", monospace;
    }

    #header,
    .aui-header-inner,
    #navigation,
    #sidebar,
    .sidebar,
    #personal-info-sidebar,
    .ia-fixed-sidebar,
    .page-actions,
    .navmenu,
    .ajs-menu-bar,
    .noprint,
    .inline-control-link,
    .inline-control-link a,
    a.show-labels-editor,
    .global-comment-actions,
    .comment-actions,
    .quick-comment-container,
    #addcomment {
        display: none !important;
    }

    /* CONF-28544 cannot print multiple pages in IE */
    #splitter-content {
        position: relative !important;
    }

    .comment .date::before {
        content: none !important; /* remove middot for print view */
    }

    h1.pagetitle img {
        height: auto;
        width: auto;
    }

    .print-only {
        display: block;
    }

    #footer {
        position: relative !important; /* CONF-17506 Place the footer at en=
d of the content */
        margin: 0;
        padding: 0;
        background: none;
        clear: both;
    }

    #poweredby {
        border-top: none;
        background: none;
    }

    #poweredby li.print-only {
        display: list-item;
        font-style: italic;
    }

    #poweredby li.noprint {
        display: none;
    }

    /* no width controls in print */
    .wiki-content .table-wrap,
    .wiki-content p,
    .panel .codeContent,
    .panel .codeContent pre,
    .image-wrap {
        overflow: visible !important;
    }

    /* TODO - should this work? */
    #children-section,
    #comments-section .comment,
    #comments-section .comment .comment-body,
    #comments-section .comment .comment-content,
    #comments-section .comment p {
        page-break-inside: avoid;
    }

    #page-children a {
        text-decoration: none;
    }

    /**
     hide twixies

     the specificity here is a hack because print styles
     are getting loaded before the base styles. */
    #comments-section.pageSection .section-header,
    #comments-section.pageSection .section-title,
    #children-section.pageSection .section-header,
    #children-section.pageSection .section-title,
    .children-show-hide {
        padding-left: 0;
        margin-left: 0;
    }

    .children-show-hide.icon {
        display: none;
    }

    /* personal sidebar */
    .has-personal-sidebar #content {
        margin-right: 0px;
    }

    .has-personal-sidebar #content .pageSection {
        margin-right: 0px;
    }

    .no-print, .no-print * {
        display: none !important;
    }
}
-->
    </style>
</head>
<body>
    <h1>Kube bench test report on DIY Cluster</h1>
    <div class=3D"Section1">
        <p>For how to perform a kube bench test, review the =E2=80=98<a hre=
f=3D"https://prevoirsolutions.atlassian.net/l/c/w2UpZEeR" class=3D"external=
-link" rel=3D"nofollow">Kubernetes Cluster scanning with Kube bench tool</a=
>=E2=80=99 page. The test report for DIY cluster has an executive summary a=
s described below:</p>
<p><strong>=3D=3D Summary total =3D=3D</strong><br><strong>60 checks PASS</=
strong><br><strong>19 checks FAIL</strong><br><strong>43 checks WARN</stron=
g><br><strong>0 checks INFO</strong></p>
<p></p>
<p>Here is a breakdown of the test.</p>
<p>nacho@node1:~$ sudo ./kube-bench<br>[INFO] 1 Master Node Security Config=
uration<br>[INFO] 1.1 Master Node Configuration Files<br>[PASS] 1.1.1 Ensur=
e that the API server pod specification file permissions are set to 644 or =
more restrictive (Automated)<br>[PASS] 1.1.2 Ensure that the API server pod=
 specification file ownership is set to root:root (Automated)<br>[PASS] 1.1=
.3 Ensure that the controller manager pod specification file permissions ar=
e set to 644 or more restrictive (Automated)<br>[PASS] 1.1.4 Ensure that th=
e controller manager pod specification file ownership is set to root:root (=
Automated)<br>[PASS] 1.1.5 Ensure that the scheduler pod specification file=
 permissions are set to 644 or more restrictive (Automated)<br>[PASS] 1.1.6=
 Ensure that the scheduler pod specification file ownership is set to root:=
root (Automated)<br><span style=3D"color: rgb(255,86,48);">[FAIL] 1.1.7 Ens=
ure that the etcd pod specification file permissions are set to 644 or more=
 restrictive (Automated)</span><br><span style=3D"color: rgb(255,86,48);">[=
FAIL] 1.1.8 Ensure that the etcd pod specification file ownership is set to=
 root:root (Automated)</span><br>[PASS] 1.1.9 Ensure that the Container Net=
work Interface file permissions are set to 644 or more restrictive (Manual)=
<br>[WARN] 1.1.10 Ensure that the Container Network Interface file ownershi=
p is set to root:root (Manual)<br><span style=3D"color: rgb(255,86,48);">[F=
AIL] 1.1.11 Ensure that the etcd data directory permissions are set to 700 =
or more restrictive (Automated)</span><br><span style=3D"color: rgb(255,86,=
48);">[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to=
 etcd:etcd (Automated)</span><br>[PASS] 1.1.13 Ensure that the admin.conf f=
ile permissions are set to 644 or more restrictive (Automated)<br>[PASS] 1.=
1.14 Ensure that the admin.conf file ownership is set to root:root (Automat=
ed)<br>[PASS] 1.1.15 Ensure that the scheduler.conf file permissions are se=
t to 644 or more restrictive (Automated)<br>[PASS] 1.1.16 Ensure that the s=
cheduler.conf file ownership is set to root:root (Automated)<br>[PASS] 1.1.=
17 Ensure that the controller-manager.conf file permissions are set to 644 =
or more restrictive (Automated)<br>[PASS] 1.1.18 Ensure that the controller=
-manager.conf file ownership is set to root:root (Automated)<br><span style=
=3D"color: rgb(255,86,48);">[FAIL] 1.1.19 Ensure that the Kubernetes PKI di=
rectory and file ownership is set to root:root (Automated)</span><br>[WARN]=
 1.1.20 Ensure that the Kubernetes PKI certificate file permissions are set=
 to 644 or more restrictive (Manual)<br>[WARN] 1.1.21 Ensure that the Kuber=
netes PKI key file permissions are set to 600 (Manual)<br>[INFO] 1.2 API Se=
rver<br>[WARN] 1.2.1 Ensure that the --anonymous-auth argument is set to fa=
lse (Manual)<br>[PASS] 1.2.2 Ensure that the --basic-auth-file argument is =
not set (Automated)<br>[PASS] 1.2.3 Ensure that the --token-auth-file param=
eter is not set (Automated)<br>[PASS] 1.2.4 Ensure that the --kubelet-https=
 argument is set to true (Automated)<br>[PASS] 1.2.5 Ensure that the --kube=
let-client-certificate and --kubelet-client-key arguments are set as approp=
riate (Automated)<br><span style=3D"color: rgb(255,86,48);">[FAIL] 1.2.6 En=
sure that the --kubelet-certificate-authority argument is set as appropriat=
e (Automated)</span><br>[PASS] 1.2.7 Ensure that the --authorization-mode a=
rgument is not set to AlwaysAllow (Automated)<br>[PASS] 1.2.8 Ensure that t=
he --authorization-mode argument includes Node (Automated)<br>[PASS] 1.2.9 =
Ensure that the --authorization-mode argument includes RBAC (Automated)<br>=
[WARN] 1.2.10 Ensure that the admission control plugin EventRateLimit is se=
t (Manual)<br>[PASS] 1.2.11 Ensure that the admission control plugin Always=
Admit is not set (Automated)<br>[WARN] 1.2.12 Ensure that the admission con=
trol plugin AlwaysPullImages is set (Manual)<br>[WARN] 1.2.13 Ensure that t=
he admission control plugin SecurityContextDeny is set if PodSecurityPolicy=
 is not used (Manual)<br>[PASS] 1.2.14 Ensure that the admission control pl=
ugin ServiceAccount is set (Automated)<br>[PASS] 1.2.15 Ensure that the adm=
ission control plugin NamespaceLifecycle is set (Automated)<br><span style=
=3D"color: rgb(255,86,48);">[FAIL] 1.2.16 Ensure that the admission control=
 plugin PodSecurityPolicy is set (Automated)</span><br>[PASS] 1.2.17 Ensure=
 that the admission control plugin NodeRestriction is set (Automated)<br>[P=
ASS] 1.2.18 Ensure that the --insecure-bind-address argument is not set (Au=
tomated)<br>[PASS] 1.2.19 Ensure that the --insecure-port argument is set t=
o 0 (Automated)<br>[PASS] 1.2.20 Ensure that the --secure-port argument is =
not set to 0 (Automated)<br>[PASS] 1.2.21 Ensure that the --profiling argum=
ent is set to false (Automated)<br><span style=3D"color: rgb(255,86,48);">[=
FAIL] 1.2.22 Ensure that the --audit-log-path argument is set (Automated)</=
span><br><span style=3D"color: rgb(255,86,48);">[FAIL] 1.2.23 Ensure that t=
he --audit-log-maxage argument is set to 30 or as appropriate (Automated)</=
span><br><span style=3D"color: rgb(255,86,48);">[FAIL] 1.2.24 Ensure that t=
he --audit-log-maxbackup argument is set to 10 or as appropriate (Automated=
)</span><br><span style=3D"color: rgb(255,86,48);">[FAIL] 1.2.25 Ensure tha=
t the --audit-log-maxsize argument is set to 100 or as appropriate (Automat=
ed)</span><br>[WARN] 1.2.26 Ensure that the --request-timeout argument is s=
et as appropriate (Automated)<br>[PASS] 1.2.27 Ensure that the --service-ac=
count-lookup argument is set to true (Automated)<br>[PASS] 1.2.28 Ensure th=
at the --service-account-key-file argument is set as appropriate (Automated=
)<br>[PASS] 1.2.29 Ensure that the --etcd-certfile and --etcd-keyfile argum=
ents are set as appropriate (Automated)<br>[PASS] 1.2.30 Ensure that the --=
tls-cert-file and --tls-private-key-file arguments are set as appropriate (=
Automated)<br>[PASS] 1.2.31 Ensure that the --client-ca-file argument is se=
t as appropriate (Automated)<br>[PASS] 1.2.32 Ensure that the --etcd-cafile=
 argument is set as appropriate (Automated)<br>[WARN] 1.2.33 Ensure that th=
e --encryption-provider-config argument is set as appropriate (Manual)<br>[=
WARN] 1.2.34 Ensure that encryption providers are appropriately configured =
(Manual)<br>[WARN] 1.2.35 Ensure that the API Server only makes use of Stro=
ng Cryptographic Ciphers (Manual)<br>[INFO] 1.3 Controller Manager<br>[PASS=
] 1.3.1 Ensure that the --terminated-pod-gc-threshold argument is set as ap=
propriate (Manual)<br>[PASS] 1.3.2 Ensure that the --profiling argument is =
set to false (Automated)<br>[PASS] 1.3.3 Ensure that the --use-service-acco=
unt-credentials argument is set to true (Automated)<br>[PASS] 1.3.4 Ensure =
that the --service-account-private-key-file argument is set as appropriate =
(Automated)<br>[PASS] 1.3.5 Ensure that the --root-ca-file argument is set =
as appropriate (Automated)<br>[PASS] 1.3.6 Ensure that the RotateKubeletSer=
verCertificate argument is set to true (Automated)<br><span style=3D"color:=
 rgb(255,86,48);">[FAIL] 1.3.7 Ensure that the --bind-address argument is s=
et to 127.0.0.1 (Automated)</span><br>[INFO] 1.4 Scheduler<br><span style=
=3D"color: rgb(255,86,48);">[FAIL] 1.4.1 Ensure that the --profiling argume=
nt is set to false (Automated)</span><br><span style=3D"color: rgb(255,86,4=
8);">[FAIL] 1.4.2 Ensure that the --bind-address argument is set to 127.0.0=
.1 (Automated)</span></p>
<p>=3D=3D Remediations master =3D=3D<br>1.1.7 Run the below command (based =
on the file location on your system) on the master node.<br>For example,<br=
>chmod 644 /etc/kubernetes/manifests/etcd.yaml</p>
<p>1.1.8 Run the below command (based on the file location on your system) =
on the master node.<br>For example,<br>chown root:root /etc/kubernetes/mani=
fests/etcd.yaml</p>
<p>1.1.10 Run the below command (based on the file location on your system)=
 on the master node.<br>For example,<br>chown root:root &lt;path/to/cni/fil=
es&gt;</p>
<p>1.1.11 On the etcd server node, get the etcd data directory, passed as a=
n argument --data-dir,<br>from the below command:<br>ps -ef | grep etcd<br>=
Run the below command (based on the etcd data directory found above). For e=
xample,<br>chmod 700 /var/lib/etcd</p>
<p>1.1.12 On the etcd server node, get the etcd data directory, passed as a=
n argument --data-dir,<br>from the below command:<br>ps -ef | grep etcd<br>=
Run the below command (based on the etcd data directory found above).<br>Fo=
r example, chown etcd:etcd /var/lib/etcd</p>
<p>1.1.19 Run the below command (based on the file location on your system)=
 on the master node.<br>For example,<br>chown -R root:root /etc/kubernetes/=
pki/</p>
<p>1.1.20 audit test did not run: failed to run: "find /etc/kubernetes/pki =
-name '<em>.crt' | xargs stat -c permissions=3D%a", output: "stat: missing =
operand\nTry 'stat --help' for more information.\n", error: exit status 123=
</em><br><em>1.1.21 audit test did not run: failed to run: "find /etc/kuber=
netes/pki -name '</em>.key' | xargs stat -c permissions=3D%a", output: "sta=
t: missing operand\nTry 'stat --help' for more information.\n", error: exit=
 status 123<br>1.2.1 Edit the API server pod specification file /etc/kubern=
etes/manifests/kube-apiserver.yaml<br>on the master node and set the below =
parameter.<br>--anonymous-auth=3Dfalse</p>
<p>1.2.6 Follow the Kubernetes documentation and setup the TLS connection b=
etween<br>the apiserver and kubelets. Then, edit the API server pod specifi=
cation file<br>/etc/kubernetes/manifests/kube-apiserver.yaml on the master =
node and set the<br>--kubelet-certificate-authority parameter to the path t=
o the cert file for the certificate authority.<br>--kubelet-certificate-aut=
hority=3D&lt;ca-string&gt;</p>
<p>1.2.10 Follow the Kubernetes documentation and set the desired limits in=
 a configuration file.<br>Then, edit the API server pod specification file =
/etc/kubernetes/manifests/kube-apiserver.yaml<br>and set the below paramete=
rs.<br>--enable-admission-plugins=3D...,EventRateLimit,...<br>--admission-c=
ontrol-config-file=3D&lt;path/to/configuration/file&gt;</p>
<p>1.2.12 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --enable-admissio=
n-plugins parameter to include<br>AlwaysPullImages.<br>--enable-admission-p=
lugins=3D...,AlwaysPullImages,...</p>
<p>1.2.13 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --enable-admissio=
n-plugins parameter to include<br>SecurityContextDeny, unless PodSecurityPo=
licy is already in place.<br>--enable-admission-plugins=3D...,SecurityConte=
xtDeny,...</p>
<p>1.2.16 Follow the documentation and create Pod Security Policy objects a=
s per your environment.<br>Then, edit the API server pod specification file=
 /etc/kubernetes/manifests/kube-apiserver.yaml<br>on the master node and se=
t the --enable-admission-plugins parameter to a<br>value that includes PodS=
ecurityPolicy:<br>--enable-admission-plugins=3D...,PodSecurityPolicy,...<br=
>Then restart the API Server.</p>
<p>1.2.22 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --audit-log-path =
parameter to a suitable path and<br>file where you would like audit logs to=
 be written, for example:<br>--audit-log-path=3D/var/log/apiserver/audit.lo=
g</p>
<p>1.2.23 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --audit-log-maxag=
e parameter to 30 or as an appropriate number of days:<br>--audit-log-maxag=
e=3D30</p>
<p>1.2.24 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --audit-log-maxba=
ckup parameter to 10 or to an appropriate<br>value.<br>--audit-log-maxbacku=
p=3D10</p>
<p>1.2.25 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the --audit-log-maxsi=
ze parameter to an appropriate size in MB.<br>For example, to set it as 100=
 MB:<br>--audit-log-maxsize=3D100</p>
<p>1.2.26 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>and set the below parameter as appropriate and i=
f needed.<br>For example,<br>--request-timeout=3D300s</p>
<p>1.2.33 Follow the Kubernetes documentation and configure a EncryptionCon=
fig file.<br>Then, edit the API server pod specification file /etc/kubernet=
es/manifests/kube-apiserver.yaml<br>on the master node and set the --encryp=
tion-provider-config parameter to the path of that file: --encryption-provi=
der-config=3D&lt;/path/to/EncryptionConfig/File&gt;</p>
<p>1.2.34 Follow the Kubernetes documentation and configure a EncryptionCon=
fig file.<br>In this file, choose aescbc, kms or secretbox as the encryptio=
n provider.</p>
<p>1.2.35 Edit the API server pod specification file /etc/kubernetes/manife=
sts/kube-apiserver.yaml<br>on the master node and set the below parameter.<=
br>--tls-cipher-suites=3DTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_=
RSA_WITH_AES_128_GCM<br>_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_=
ECDHE_RSA_WITH_AES_256_GCM<br>_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,=
TLS_ECDHE_ECDSA_WITH_AES_256_GCM<br>_SHA384</p>
<p>1.3.7 Edit the Controller Manager pod specification file /etc/kubernetes=
/manifests/kube-controller-manager.yaml<br>on the master node and ensure th=
e correct value for the --bind-address parameter</p>
<p>1.4.1 Edit the Scheduler pod specification file /etc/kubernetes/manifest=
s/kube-scheduler.yaml file<br>on the master node and set the below paramete=
r.<br>--profiling=3Dfalse</p>
<p>1.4.2 Edit the Scheduler pod specification file /etc/kubernetes/manifest=
s/kube-scheduler.yaml<br>on the master node and ensure the correct value fo=
r the --bind-address parameter</p>
<p>=3D=3D Summary master =3D=3D<br>40 checks PASS<br>14 checks FAIL<br>11 c=
hecks WARN<br>0 checks INFO</p>
<p>[INFO] 2 Etcd Node Configuration<br>[INFO] 2 Etcd Node Configuration Fil=
es<br><span style=3D"color: rgb(255,86,48);">[FAIL] 2.1 Ensure that the --c=
ert-file and --key-file arguments are set as appropriate (Automated)</span>=
<br><span style=3D"color: rgb(255,86,48);">[FAIL] 2.2 Ensure that the --cli=
ent-cert-auth argument is set to true (Automated)</span><br>[PASS] 2.3 Ensu=
re that the --auto-tls argument is not set to true (Automated)<br><span sty=
le=3D"color: rgb(255,86,48);">[FAIL] 2.4 Ensure that the --peer-cert-file a=
nd --peer-key-file arguments are set as appropriate (Automated)</span><br><=
span style=3D"color: rgb(255,86,48);">[FAIL] 2.5 Ensure that the --peer-cli=
ent-cert-auth argument is set to true (Automated)</span><br>[PASS] 2.6 Ensu=
re that the --peer-auto-tls argument is not set to true (Automated)<br>[WAR=
N] 2.7 Ensure that a unique Certificate Authority is used for etcd (Manual)=
</p>
<p>=3D=3D Remediations etcd =3D=3D<br>2.1 Follow the etcd service documenta=
tion and configure TLS encryption.<br>Then, edit the etcd pod specification=
 file /etc/kubernetes/manifests/etcd.yaml<br>on the master node and set the=
 below parameters.<br>--cert-file=3D&lt;/path/to/ca-file&gt;<br>--key-file=
=3D&lt;/path/to/key-file&gt;</p>
<p>2.2 Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.=
yaml on the master<br>node and set the below parameter.<br>--client-cert-au=
th=3D"true"</p>
<p>2.4 Follow the etcd service documentation and configure peer TLS encrypt=
ion as appropriate<br>for your etcd cluster.<br>Then, edit the etcd pod spe=
cification file /etc/kubernetes/manifests/etcd.yaml on the<br>master node a=
nd set the below parameters.<br>--peer-client-file=3D&lt;/path/to/peer-cert=
-file&gt;<br>--peer-key-file=3D&lt;/path/to/peer-key-file&gt;</p>
<p>2.5 Edit the etcd pod specification file /etc/kubernetes/manifests/etcd.=
yaml on the master<br>node and set the below parameter.<br>--peer-client-ce=
rt-auth=3Dtrue</p>
<p>2.7 [Manual test]<br>Follow the etcd documentation and create a dedicate=
d certificate authority setup for the<br>etcd service.<br>Then, edit the et=
cd pod specification file /etc/kubernetes/manifests/etcd.yaml on the<br>mas=
ter node and set the below parameter.<br>--trusted-ca-file=3D&lt;/path/to/c=
a-file&gt;</p>
<p>=3D=3D Summary etcd =3D=3D<br>2 checks PASS<br>4 checks FAIL<br>1 checks=
 WARN<br>0 checks INFO</p>
<p>[INFO] 3 Control Plane Configuration<br>[INFO] 3.1 Authentication and Au=
thorization<br>[WARN] 3.1.1 Client certificate authentication should not be=
 used for users (Manual)<br>[INFO] 3.2 Logging<br>[WARN] 3.2.1 Ensure that =
a minimal audit policy is created (Manual)<br>[WARN] 3.2.2 Ensure that the =
audit policy covers key security concerns (Manual)</p>
<p>=3D=3D Remediations controlplane =3D=3D<br>3.1.1 Alternative mechanisms =
provided by Kubernetes such as the use of OIDC should be<br>implemented in =
place of client certificates.</p>
<p>3.2.1 Create an audit policy file for your cluster.</p>
<p>3.2.2 Consider modification of the audit policy in use on the cluster to=
 include these items, at a<br>minimum.</p>
<p>=3D=3D Summary controlplane =3D=3D<br>0 checks PASS<br>0 checks FAIL<br>=
3 checks WARN<br>0 checks INFO</p>
<p>[INFO] 4 Worker Node Security Configuration<br>[INFO] 4.1 Worker Node Co=
nfiguration Files<br>[PASS] 4.1.1 Ensure that the kubelet service file perm=
issions are set to 644 or more restrictive (Automated)<br>[PASS] 4.1.2 Ensu=
re that the kubelet service file ownership is set to root:root (Automated)<=
br>[PASS] 4.1.3 If proxy kubeconfig file exists ensure permissions are set =
to 644 or more restrictive (Manual)<br>[PASS] 4.1.4 Ensure that the proxy k=
ubeconfig file ownership is set to root:root (Manual)<br>[PASS] 4.1.5 Ensur=
e that the --kubeconfig kubelet.conf file permissions are set to 644 or mor=
e restrictive (Automated)<br>[PASS] 4.1.6 Ensure that the --kubeconfig kube=
let.conf file ownership is set to root:root (Manual)<br>[PASS] 4.1.7 Ensure=
 that the certificate authorities file permissions are set to 644 or more r=
estrictive (Manual)<br>[PASS] 4.1.8 Ensure that the client certificate auth=
orities file ownership is set to root:root (Manual)<br>[PASS] 4.1.9 Ensure =
that the kubelet --config configuration file has permissions set to 644 or =
more restrictive (Automated)<br>[PASS] 4.1.10 Ensure that the kubelet --con=
fig configuration file ownership is set to root:root (Automated)<br>[INFO] =
4.2 Kubelet<br>[PASS] 4.2.1 Ensure that the anonymous-auth argument is set =
to false (Automated)<br>[PASS] 4.2.2 Ensure that the --authorization-mode a=
rgument is not set to AlwaysAllow (Automated)<br>[PASS] 4.2.3 Ensure that t=
he --client-ca-file argument is set as appropriate (Automated)<br>[PASS] 4.=
2.4 Ensure that the --read-only-port argument is set to 0 (Manual)<br>[PASS=
] 4.2.5 Ensure that the --streaming-connection-idle-timeout argument is not=
 set to 0 (Manual)<br><span style=3D"color: rgb(255,86,48);">[FAIL] 4.2.6 E=
nsure that the --protect-kernel-defaults argument is set to true (Automated=
)</span><br>[PASS] 4.2.7 Ensure that the --make-iptables-util-chains argume=
nt is set to true (Automated)<br>[WARN] 4.2.8 Ensure that the --hostname-ov=
erride argument is not set (Manual)<br>[WARN] 4.2.9 Ensure that the --event=
-qps argument is set to 0 or a level which ensures appropriate event captur=
e (Manual)<br>[WARN] 4.2.10 Ensure that the --tls-cert-file and --tls-priva=
te-key-file arguments are set as appropriate (Manual)<br>[PASS] 4.2.11 Ensu=
re that the --rotate-certificates argument is not set to false (Manual)<br>=
[PASS] 4.2.12 Verify that the RotateKubeletServerCertificate argument is se=
t to true (Manual)<br>[WARN] 4.2.13 Ensure that the Kubelet only makes use =
of Strong Cryptographic Ciphers (Manual)</p>
<p>=3D=3D Remediations node =3D=3D<br>4.2.6 If using a Kubelet config file,=
 edit the file to set protectKernelDefaults: true.<br>If using command line=
 arguments, edit the kubelet service file<br>/etc/systemd/system/kubelet.se=
rvice on each worker node and<br>set the below parameter in KUBELET_SYSTEM_=
PODS_ARGS variable.<br>--protect-kernel-defaults=3Dtrue<br>Based on your sy=
stem, restart the kubelet service. For example:<br>systemctl daemon-reload<=
br>systemctl restart kubelet.service</p>
<p>4.2.8 Edit the kubelet service file /etc/systemd/system/kubelet.service<=
br>on each worker node and remove the --hostname-override argument from the=
<br>KUBELET_SYSTEM_PODS_ARGS variable.<br>Based on your system, restart the=
 kubelet service. For example:<br>systemctl daemon-reload<br>systemctl rest=
art kubelet.service</p>
<p>4.2.9 If using a Kubelet config file, edit the file to set eventRecordQP=
S: to an appropriate level.<br>If using command line arguments, edit the ku=
belet service file<br>/etc/systemd/system/kubelet.service on each worker no=
de and<br>set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.<br>=
Based on your system, restart the kubelet service. For example:<br>systemct=
l daemon-reload<br>systemctl restart kubelet.service</p>
<p>4.2.10 If using a Kubelet config file, edit the file to set tlsCertFile =
to the location<br>of the certificate file to use to identify this Kubelet,=
 and tlsPrivateKeyFile<br>to the location of the corresponding private key =
file.<br>If using command line arguments, edit the kubelet service file<br>=
/etc/systemd/system/kubelet.service on each worker node and<br>set the belo=
w parameters in KUBELET_CERTIFICATE_ARGS variable.<br>--tls-cert-file=3D&lt=
;path/to/tls-certificate-file&gt;<br>--tls-private-key-file=3D&lt;path/to/t=
ls-key-file&gt;<br>Based on your system, restart the kubelet service. For e=
xample:<br>systemctl daemon-reload<br>systemctl restart kubelet.service</p>
<p>4.2.13 If using a Kubelet config file, edit the file to set TLSCipherSui=
tes: to<br>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_1=
28_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES=
_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_A=
ES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_=
SHA256<br>or to a subset of these values.<br>If using executable arguments,=
 edit the kubelet service file<br>/etc/systemd/system/kubelet.service on ea=
ch worker node and<br>set the --tls-cipher-suites parameter as follows, or =
to a subset of these values.<br>--tls-cipher-suites=3DTLS_ECDHE_ECDSA_WITH_=
AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WI=
TH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WI=
TH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_A=
ES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256<br>Based on your system, =
restart the kubelet service. For example:<br>systemctl daemon-reload<br>sys=
temctl restart kubelet.service</p>
<p>=3D=3D Summary node =3D=3D<br>18 checks PASS<br>1 checks FAIL<br>4 check=
s WARN<br>0 checks INFO</p>
<p>[INFO] 5 Kubernetes Policies<br>[INFO] 5.1 RBAC and Service Accounts<br>=
[WARN] 5.1.1 Ensure that the cluster-admin role is only used where required=
 (Manual)<br>[WARN] 5.1.2 Minimize access to secrets (Manual)<br>[WARN] 5.1=
.3 Minimize wildcard use in Roles and ClusterRoles (Manual)<br>[WARN] 5.1.4=
 Minimize access to create pods (Manual)<br>[WARN] 5.1.5 Ensure that defaul=
t service accounts are not actively used. (Manual)<br>[WARN] 5.1.6 Ensure t=
hat Service Account Tokens are only mounted where necessary (Manual)<br>[IN=
FO] 5.2 Pod Security Policies<br>[WARN] 5.2.1 Minimize the admission of pri=
vileged containers (Manual)<br>[WARN] 5.2.2 Minimize the admission of conta=
iners wishing to share the host process ID namespace (Manual)<br>[WARN] 5.2=
.3 Minimize the admission of containers wishing to share the host IPC names=
pace (Manual)<br>[WARN] 5.2.4 Minimize the admission of containers wishing =
to share the host network namespace (Manual)<br>[WARN] 5.2.5 Minimize the a=
dmission of containers with allowPrivilegeEscalation (Manual)<br>[WARN] 5.2=
.6 Minimize the admission of root containers (Manual)<br>[WARN] 5.2.7 Minim=
ize the admission of containers with the NET_RAW capability (Manual)<br>[WA=
RN] 5.2.8 Minimize the admission of containers with added capabilities (Man=
ual)<br>[WARN] 5.2.9 Minimize the admission of containers with capabilities=
 assigned (Manual)<br>[INFO] 5.3 Network Policies and CNI<br>[WARN] 5.3.1 E=
nsure that the CNI in use supports Network Policies (Manual)<br>[WARN] 5.3.=
2 Ensure that all Namespaces have Network Policies defined (Manual)<br>[INF=
O] 5.4 Secrets Management<br>[WARN] 5.4.1 Prefer using secrets as files ove=
r secrets as environment variables (Manual)<br>[WARN] 5.4.2 Consider extern=
al secret storage (Manual)<br>[INFO] 5.5 Extensible Admission Control<br>[W=
ARN] 5.5.1 Configure Image Provenance using ImagePolicyWebhook admission co=
ntroller (Manual)<br>[INFO] 5.7 General Policies<br>[WARN] 5.7.1 Create adm=
inistrative boundaries between resources using namespaces (Manual)<br>[WARN=
] 5.7.2 Ensure that the seccomp profile is set to docker/default in your po=
d definitions (Manual)<br>[WARN] 5.7.3 Apply Security Context to Your Pods =
and Containers (Manual)<br>[WARN] 5.7.4 The default namespace should not be=
 used (Manual)</p>
<p>=3D=3D Remediations policies =3D=3D<br>5.1.1 Identify all clusterrolebin=
dings to the cluster-admin role. Check if they are used and<br>if they need=
 this role or if they could use a role with fewer privileges.<br>Where poss=
ible, first bind users to a lower privileged role and then remove the<br>cl=
usterrolebinding to the cluster-admin role :<br>kubectl delete clusterroleb=
inding [name]</p>
<p>5.1.2 Where possible, remove get, list and watch access to secret object=
s in the cluster.</p>
<p>5.1.3 Where possible replace any use of wildcards in clusterroles and ro=
les with specific<br>objects or actions.</p>
<p>5.1.4 Where possible, remove create access to pod objects in the cluster=
.</p>
<p>5.1.5 Create explicit service accounts wherever a Kubernetes workload re=
quires specific access<br>to the Kubernetes API server.<br>Modify the confi=
guration of each default service account to include this value<br>automount=
ServiceAccountToken: false</p>
<p>5.1.6 Modify the definition of pods and service accounts which do not ne=
ed to mount service<br>account tokens to disable it.</p>
<p>5.2.1 Create a PSP as described in the Kubernetes documentation, ensurin=
g that<br>the .spec.privileged field is omitted or set to false.</p>
<p>5.2.2 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.hostPID field is omitted or set to false.</p>
<p>5.2.3 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.hostIPC field is omitted or set to false.</p>
<p>5.2.4 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.hostNetwork field is omitted or set to false.</p>
<p>5.2.5 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.allowPrivilegeEscalation field is omitted or set to fal=
se.</p>
<p>5.2.6 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.runAsUser.rule is set to either MustRunAsNonRoot or Mus=
tRunAs with the range of<br>UIDs not including 0.</p>
<p>5.2.7 Create a PSP as described in the Kubernetes documentation, ensurin=
g that the<br>.spec.requiredDropCapabilities is set to include either NET_R=
AW or ALL.</p>
<p>5.2.8 Ensure that allowedCapabilities is not present in PSPs for the clu=
ster unless<br>it is set to an empty array.</p>
<p>5.2.9 Review the use of capabilites in applications running on your clus=
ter. Where a namespace<br>contains applicaions which do not require any Lin=
ux capabities to operate consider adding<br>a PSP which forbids the admissi=
on of containers which do not drop all capabilities.</p>
<p>5.3.1 If the CNI plugin in use does not support network policies, consid=
eration should be given to<br>making use of a different plugin, or finding =
an alternate mechanism for restricting traffic<br>in the Kubernetes cluster=
.</p>
<p>5.3.2 Follow the documentation and create NetworkPolicy objects as you n=
eed them.</p>
<p>5.4.1 if possible, rewrite application code to read secrets from mounted=
 secret files, rather than<br>from environment variables.</p>
<p>5.4.2 Refer to the secrets management options offered by your cloud prov=
ider or a third-party<br>secrets management solution.</p>
<p>5.5.1 Follow the Kubernetes documentation and setup image provenance.</p=
>
<p>5.7.1 Follow the documentation and create namespaces for objects in your=
 deployment as you need<br>them.</p>
<p>5.7.2 Seccomp is an alpha feature currently. By default, all alpha featu=
res are disabled. So, you<br>would need to enable alpha features in the api=
server by passing "--feature-<br>gates=3DAllAlpha=3Dtrue" argument.<br>Edit=
 the /etc/kubernetes/apiserver file on the master node and set the KUBE_API=
_ARGS<br>parameter to "--feature-gates=3DAllAlpha=3Dtrue"<br>KUBE_API_ARGS=
=3D"--feature-gates=3DAllAlpha=3Dtrue"<br>Based on your system, restart the=
 kube-apiserver service. For example:<br>systemctl restart kube-apiserver.s=
ervice<br>Use annotations to enable the docker/default seccomp profile in y=
our pod definitions. An<br>example is as below:<br>apiVersion: v1<br>kind: =
Pod<br>metadata:<br>name: trustworthy-pod<br>annotations:<br><a href=3D"htt=
p://seccomp.security.alpha.kubernetes.io/pod:" class=3D"external-link" rel=
=3D"nofollow">seccomp.security.alpha.kubernetes.io/pod:</a> docker/default<=
br>spec:<br>containers:<br>- name: trustworthy-container<br>image: sotrustw=
orthy:latest</p>
<p>5.7.3 Follow the Kubernetes documentation and apply security contexts to=
 your pods. For a<br>suggested list of security contexts, you may refer to =
the CIS Security Benchmark for Docker<br>Containers.</p>
<p>5.7.4 Ensure that namespaces are created to allow for appropriate segreg=
ation of Kubernetes<br>resources and that all new resources are created in =
a specific namespace.</p>
<p>=3D=3D Summary policies =3D=3D<br>0 checks PASS<br>0 checks FAIL<br>24 c=
hecks WARN<br>0 checks INFO</p>
<p><strong>=3D=3D Summary total =3D=3D</strong><br><strong>60 checks PASS</=
strong><br><strong>19 checks FAIL</strong><br><strong>43 checks WARN</stron=
g><br><strong>0 checks INFO</strong></p>
<p></p>
    </div>
</body>
</html>
------=_Part_8_1061738197.1647507215344--
